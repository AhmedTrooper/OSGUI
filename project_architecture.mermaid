classDiagram
    direction TB
    %% Core Front End Components
    class App {
        +init()
        +useEffect(detectOS)
        +useEffect(createOrLoadDatabase)
    }

    %% UI Components
    class UserInputSection {
        +Input videoUrl
        +Switch downloadPlaylist
        +Button Search
        +fetchVideoInformation()
        +clipboardReadingHandle()
    }

    class DownloadSection {
        +List downloadsArr
        +displayItems()
        +handlePause()
        +handleRemove()
    }

    class DownloadsHeader {
        +Label Title
        +Label Status
        +Label Actions
    }

    class PlaylistSection {
        +HeavyPlaylistFormatSection
        +SelectedLightEntries
        +handleBatchDownload()
    }
    
    class ThemeToggleButton {
        +toggleTheme()
    }

    %% State Management
    class UserInputVideoStore {
        +string videoUrl
        +bool downloadPlaylist
        +bool showNonMedia
        +VideoInformationInterface videoInformation
        +DownloadListInterface[] downloadsArr
        +bool isLoadingForJsonCreation
        +bool videoInformationFetchFailed
        +setVideoUrl()
        +fetchVideoInformation()
        +readJsonFile()
        +addVideoToDownloadsArr()
        +clipboardReadingHandle()
    }

    class DownloadStore {
        +number defaultTimeInterval
        +string selectedFormat
        +string selectedAudioStream
        +string selectedVideoStream
        +downloadHandler(format, url, title)
        +videoStreamSelect()
        +audioStreamSelect()
        +setDefaultTimeInterval()
    }

    class DatabaseStore {
        +bool databaseLoaded
        +createOrLoadDatabase()
        +supabaseQueryInsert()
        +singleFileRemove(uniqueId)
        +emptyDatabase()
    }

    class HeavyPlaylistStore {
        +string playlistUrl
        +bool playlistFetchFailed
        +bool playlistFetchLoading
        +HeavyPlaylistInformationInterface heavyPlaylistInformation
        +LightPlaylistEntry[] lightEntriesArr
        +fetchHeavyPlaylistInformation()
        +readHeavyPlaylistJsonFile()
        +lightPlaylistSingleDownloadHandler()
        +lightPlaylistBatchDownload()
    }

    class ApplicationStore {
        +string ytDlpVersion
        +fetchAppVersion()
    }
    
    class OsInfoStore {
        +detectMobileOS()
    }
    
    class ThemeStore {
        +bool dark
        +setDark()
    }

    %% Backend Services Tauri
    class TauriPluginShell {
        <<Service>>
        +Command(program, args)
        +spawn()
        +on('data')
        +on('close')
        +kill()
    }

    class TauriPluginSQL {
        <<Service>>
        +Database.load(path)
        +execute(query, args)
        +select(query)
    }

    class TauriPluginFS {
        <<Service>>
        +readDir(path)
        +mkdir(path)
        +writeTextFile(path, contents)
        +readTextFile(path)
        +exists(path)
    }

    class TauriPluginOS {
            <<Service>>
            +platform()
            +arch()
            +hostname()
    }
    
    class YtDlpBinary {
        <<Binary>>
        +param --dump-json
        +param --flat-playlist
        +param -f format
        +param -o output_template
    }

    %% Data Models
    class DownloadListTable {
        <<SQLite Table>>
        +String id (PK)
        +String unique_id
        +Boolean active
        +Boolean failed
        +Boolean completed
        +Boolean isPaused
        +String format_id
        +String web_url
        +String title
        +String tracking_message
    }

    class VideoJson {
            <<File>>
            +JSON content
    }
    
    class PlaylistJson {
            <<File>>
            +JSON content
    }

    %% Relationships - UI to Store
    App --> DatabaseStore : Initializes
    App --> OsInfoStore : Checks OS
    App --> ThemeStore : Sets Theme
    
    UserInputSection ..> UserInputVideoStore : Binds Input/Actions
    DownloadSection ..> UserInputVideoStore : Reads downloadsArr
    DownloadSection ..> DownloadStore : Invokes Download
    DownloadSection ..> DownloadsHeader : Includes
    DownloadSection ..> DatabaseStore : Removes Items

    PlaylistSection ..> HeavyPlaylistStore : Binds Playlist Data
    
    %% Relationships - Store to Backend
    UserInputVideoStore ..> TauriPluginShell : Spawns YtDlp (Metadata)
    UserInputVideoStore ..> TauriPluginFS : Writes/Reads video.json
    UserInputVideoStore ..> YtDlpBinary : Executes --dump-json
    
    DownloadStore ..> TauriPluginShell : Spawns YtDlp (Download)
    DownloadStore ..> TauriPluginSQL : SELECT/INSERT/UPDATE DownloadList
    DownloadStore ..> YtDlpBinary : Executes Download Command
    
    DatabaseStore ..> TauriPluginSQL : CREATE/DROP Table
    DatabaseStore ..> TauriPluginOS : Collects Analytics
    
    HeavyPlaylistStore ..> TauriPluginShell : Spawns YtDlp (Playlist Info)
    HeavyPlaylistStore ..> TauriPluginFS : Writes/Reads playlist.json
    HeavyPlaylistStore ..> YtDlpBinary : Executes --flat-playlist

    %% Relationships - Store to Data
    DatabaseStore ..> DownloadListTable : Manages Schema
    DownloadStore ..> DownloadListTable : Polls & Updates Status
    
    UserInputVideoStore ..> VideoJson : Caches Metadata
    HeavyPlaylistStore ..> PlaylistJson : Caches Metadata

    %% Store Inter-dependencies
    DownloadStore ..> UserInputVideoStore : Updates shared downloadsArr
    DatabaseStore ..> UserInputVideoStore : Hydrates initial downloadsArr
